name: 'Pull request (Terragrunt Plan)'
on:
  workflow_dispatch:
# on:
#   pull_request:
#     # Sequence of patterns matched against refs/heads
#     branches:
#       - main
env:
  tf_version: 'latest'
  tg_version: 'latest'
  tf_working_dir: '.'

jobs:
  terragrunt:
    name: Example Terragrunt interaction
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup Terragrunt
        uses: autero1/action-terragrunt@v1.1.0
        with:
          terragrunt_version: 0.38.7
      - name: Interact with Terragrunt
        run: terragrunt --version
      
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v34
        with:
          files: |
            staging/**

      - name: List all changed files
        run: |
          ls -lah
          echo $PWD
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            if [[ $file == *.hcl ]]; then
              cd $(dirname $file)
              terragrunt plan
            fi
          done

      
      # - uses: actions/github-script@v5
      #   with:
      #     github-token: ${{secrets.COMMENT_TOKEN}}
      #     script: |
      #       github.rest.issues.createComment({
      #         issue_number: context.issue.number,
      #         owner: context.repo.owner,
      #         repo: context.repo.repo,
      #         body: 'ðŸ‘‹ Thanks for reporting!'
      #       })
